<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Beat Frequency Generator</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        background-color: #00008B; /* dark blue background */
        height: 100%;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      .container {
        position: relative;
        width: 100%;
        height: 100%;
      }
      /* White circle (the control area) */
      #circle {
        position: absolute;
        width: 300px;
        height: 300px;
        background-color: #ffffff;
        border: 4px solid #ffffff;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      /* Frequency display is centered inside the circle */
      #frequency-display {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: #000000;
        font-size: 16px;
        line-height: 1.5;
      }
      /* Draggable handles */
      .handle {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: #ffffff;
        border: 2px solid #00AA00;
        border-radius: 50%;
        cursor: pointer;
        user-select: none;
      }
      /* Play/Pause button */
      #play-pause {
        position: absolute;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        background-color: #00AA00;
        color: #ffffff;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="circle">
        <div id="frequency-display">
          <div id="freq1-text">Freq1: 440 Hz</div>
          <div id="freq2-text">Freq2: 445 Hz</div>
          <div id="beat-text">Beat: 5 Hz</div>
        </div>
        <!-- Left handle for Frequency 1 -->
        <div id="left-handle" class="handle"></div>
        <!-- Right handle for Frequency 2 -->
        <div id="right-handle" class="handle"></div>
      </div>
      <button id="play-pause">Play</button>
    </div>
    <script>
      // Frequency mapping: frequency in [400,480] Hz from a 90° arc.
      // Left handle allowed angle: between 135° (max frequency 400 Hz) and 225° (min frequency 480 Hz).
      // Right handle allowed angle: between -45° (min frequency 400 Hz) and 45° (max frequency 480 Hz).
      const freqMin = 400;
      const freqMax = 480;
      const angleRange = 90; // degrees
      
      // Default frequencies
      let leftFrequency = 440;
      let rightFrequency = 445;
      
      // Compute default angles based on linear mapping.
      // For left handle: angle = 225 - ((freq - 400)/(80))*90 (so freq=440 gives 225 - (40/80*90)=225-45=180°).
      let leftAngle = 225 - ((leftFrequency - freqMin) / (freqMax - freqMin)) * angleRange;
      // For right handle: angle = -45 + ((freq - 400)/80)*90 (so freq=445 gives -45 + (45/80*90)).
      let rightAngle = -45 + ((rightFrequency - freqMin) / (freqMax - freqMin)) * angleRange;
      
      // References to elements
      const circle = document.getElementById("circle");
      const leftHandle = document.getElementById("left-handle");
      const rightHandle = document.getElementById("right-handle");
      const freq1Text = document.getElementById("freq1-text");
      const freq2Text = document.getElementById("freq2-text");
      const beatText = document.getElementById("beat-text");
      const playPauseButton = document.getElementById("play-pause");
      
      // Get circle properties (center coordinates, radius)
      const circleRect = circle.getBoundingClientRect();
      const circleRadius = circleRect.width / 2;
      const circleCenter = {
        x: circleRect.left + circleRadius,
        y: circleRect.top + circleRadius
      };
      
      // Function to set handle positions based on angle (in degrees)
      function updateHandlePosition(handleElement, angleDeg) {
        const rad = angleDeg * Math.PI / 180;
        // Position relative to circle container (300x300), with center at (150,150)
        const x = circleRadius + circleRadius * Math.cos(rad) - handleElement.offsetWidth / 2;
        const y = circleRadius + circleRadius * Math.sin(rad) - handleElement.offsetHeight / 2;
        handleElement.style.left = x + "px";
        handleElement.style.top = y + "px";
      }
      
      // Update both handles positions initially
      updateHandlePosition(leftHandle, leftAngle);
      updateHandlePosition(rightHandle, rightAngle);
      
      // Update frequency display
      function updateDisplay() {
        const beat = Math.abs(leftFrequency - rightFrequency).toFixed(1);
        freq1Text.textContent = "Freq1: " + leftFrequency.toFixed(1) + " Hz";
        freq2Text.textContent = "Freq2: " + rightFrequency.toFixed(1) + " Hz";
        beatText.textContent = "Beat: " + beat + " Hz";
      }
      updateDisplay();
      
      // Audio setup
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc1 = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      osc1.type = "sine";
      osc2.type = "sine";
      osc1.frequency.setValueAtTime(leftFrequency, audioCtx.currentTime);
      osc2.frequency.setValueAtTime(rightFrequency, audioCtx.currentTime);
      osc1.connect(audioCtx.destination);
      osc2.connect(audioCtx.destination);
      let audioStarted = false;
      
      // Toggle play/pause when button is clicked
      let audioRunning = false;
      playPauseButton.addEventListener("click", () => {
        if (!audioStarted) {
          osc1.start();
          osc2.start();
          audioCtx.resume();
          audioStarted = true;
          audioRunning = true;
          playPauseButton.textContent = "Pause";
        } else {
          if (audioRunning) {
            audioCtx.suspend();
            playPauseButton.textContent = "Play";
            audioRunning = false;
          } else {
            audioCtx.resume();
            playPauseButton.textContent = "Pause";
            audioRunning = true;
          }
        }
      });
      
      let activeHandle = null;
      
      // mousedown event on handles
      function handleMouseDown(e, handleType) {
        activeHandle = handleType;
        e.preventDefault();
      }
      
      leftHandle.addEventListener("mousedown", (e) => {
        handleMouseDown(e, "left");
      });
      rightHandle.addEventListener("mousedown", (e) => {
        handleMouseDown(e, "right");
      });
      
      // Mousemove event over the document to drag the handles
      document.addEventListener("mousemove", (e) => {
        if (!activeHandle) return;
        // Get center of the circle (adjust for page scrolling using clientX/clientY)
        const rect = circle.getBoundingClientRect();
        const centerX = rect.left + circleRadius;
        const centerY = rect.top + circleRadius;
        const dx = e.clientX - centerX;
        const dy = e.clientY - centerY;
        let angle = Math.atan2(dy, dx) * 180 / Math.PI;
        // Normalize angle to range (-180, 180]
        if(angle > 180) angle -= 360;
      
        if (activeHandle === "left") {
          // Constrain angle between 135 and 225 degrees.
          // For simplicity, we map angles in [135,225] (which in our coordinate system are all >90).
          // In our mapping we treat left handle angle in degrees as is.
          if (angle < 135) angle = 135;
          if (angle > 225) angle = 225;
          leftAngle = angle;
          // Map angle to frequency: frequency = 400 + ((225 - angle)/90)*80.
          leftFrequency = freqMin + ((225 - leftAngle) / angleRange) * (freqMax - freqMin);
          updateHandlePosition(leftHandle, leftAngle);
        } else if (activeHandle === "right") {
          // For right handle, allow angle between -45 and 45.
          if (angle < -45) angle = -45;
          if (angle > 45) angle = 45;
          rightAngle = angle;
          // Map angle to frequency: frequency = 400 + ((angle + 45)/90)*80.
          rightFrequency = freqMin + ((rightAngle + 45) / angleRange) * (freqMax - freqMin);
          updateHandlePosition(rightHandle, rightAngle);
        }
        updateDisplay();
        if(audioStarted && audioRunning) {
          osc1.frequency.setValueAtTime(leftFrequency, audioCtx.currentTime);
          osc2.frequency.setValueAtTime(rightFrequency, audioCtx.currentTime);
        }
      });
      
      // Mouseup: stop dragging
      document.addEventListener("mouseup", () => {
        activeHandle = null;
      });
    </script>
  </body>
</html>
