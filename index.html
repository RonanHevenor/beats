<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Beat Frequency Generator - Modernized</title>
    <style>
      /* Reset & Basic Body */
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #0a0f24;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #fff;
      }
      /* Background canvas */
      #bgCanvas {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 0;
      }
      /* Central container for controls */
      .container {
        position: relative;
        z-index: 2;
        width: 100%;
        height: 100%;
      }
      /* Main control circle */
      #circle {
        position: absolute;
        width: 400px;
        height: 400px;
        background-color: #ffffff;
        border: 4px solid #ffffff;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        overflow: visible;
      }
      /* SVG arcs for indicators */
      #arc-svg {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
      }
      /* Draggable handle style */
      .handle {
        position: absolute;
        width: 24px;
        height: 24px;
        background-color: #ffffff;
        border: 3px solid #00AA00;
        border-radius: 50%;
        cursor: pointer;
        user-select: none;
        z-index: 3;
      }
      /* Moving dot style */
      .moving-dot {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #ffffff;
        border-radius: 50%;
        z-index: 2;
      }
      /* Frequency number texts */
      .freq-num {
        position: absolute;
        font-size: 32px;
        font-weight: bold;
        text-shadow: 1px 1px 5px rgba(0,0,0,0.6);
        z-index: 4;
        white-space: nowrap;
        color: #00AA00;
      }
      /* Beat frequency center text */
      #beat-freq {
        position: absolute;
        width: 100%;
        text-align: center;
        bottom: 20px;
        font-size: 40px;
        font-weight: bold;
        text-shadow: 1px 1px 5px rgba(0,0,0,0.6);
        z-index: 4;
        color: #fff;
      }
      /* State based play/pause button as icon */
      #play-pause {
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: none;
        border: none;
        cursor: pointer;
        z-index: 4;
        outline: none;
      }
      #play-pause svg {
        width: 60px;
        height: 60px;
        fill: #00AA00;
        filter: drop-shadow(1px 1px 5px rgba(0,0,0,0.6));
      }
    </style>
  </head>
  <body>
    <!-- Background Canvas for drifting blue dots and connecting lines -->
    <canvas id="bgCanvas"></canvas>

    <div class="container">
      <div id="circle">
        <!-- SVG for drawing arcs behind the handles -->
        <svg id="arc-svg" width="400" height="400" viewBox="0 0 400 400">
          <!-- Left arc path -->
          <path id="left-arc" fill="none" stroke="#00FF00" stroke-width="8" />
          <!-- Right arc path -->
          <path id="right-arc" fill="none" stroke="#00FF00" stroke-width="8" />
        </svg>
        <!-- Draggable handles -->
        <div id="left-handle" class="handle"></div>
        <div id="right-handle" class="handle"></div>
        <!-- Moving dots -->
        <div id="left-moving-dot" class="moving-dot"></div>
        <div id="right-moving-dot" class="moving-dot"></div>
      </div>
      <!-- Frequency number texts -->
      <div id="left-freq" class="freq-num"></div>
      <div id="right-freq" class="freq-num"></div>
      <!-- Beat frequency text -->
      <div id="beat-freq"></div>
      <!-- Play/Pause button with icon -->
      <button id="play-pause">
        <!-- Start with Play Icon -->
        <svg id="play-icon" viewBox="0 0 64 64">
          <polygon points="16,12 16,52 48,32" />
        </svg>
      </button>
    </div>

    <script>
      /* ===============================
         Background Animation - Drifting Blue Dots
         =============================== */
      const bgCanvas = document.getElementById("bgCanvas");
      const bgCtx = bgCanvas.getContext("2d");
      let bgWidth = window.innerWidth, bgHeight = window.innerHeight;
      bgCanvas.width = bgWidth;
      bgCanvas.height = bgHeight;

      // Create 100 dots with random positions and velocities
      const dotCount = 100;
      const dots = [];
      for (let i = 0; i < dotCount; i++) {
        dots.push({
          x: Math.random() * bgWidth,
          y: Math.random() * bgHeight,
          vx: (Math.random() - 0.5) * 0.5,
          vy: (Math.random() - 0.5) * 0.5,
          radius: 2 + Math.random() * 2
        });
      }

      function animateBackground() {
        bgCtx.clearRect(0, 0, bgWidth, bgHeight);
        // update positions
        dots.forEach(dot => {
          dot.x += dot.vx;
          dot.y += dot.vy;
          if(dot.x < 0 || dot.x > bgWidth) dot.vx *= -1;
          if(dot.y < 0 || dot.y > bgHeight) dot.vy *= -1;
        });
        // Connect dots that are close
        for(let i = 0; i < dotCount; i++){
          for(let j = i + 1; j < dotCount; j++){
            const dx = dots[i].x - dots[j].x;
            const dy = dots[i].y - dots[j].y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const maxDist = 100;
            if(dist < maxDist){
              const opacity = 1 - dist/maxDist;
              bgCtx.strokeStyle = "rgba(0,170,170," + opacity + ")";
              bgCtx.lineWidth = 1;
              bgCtx.beginPath();
              bgCtx.moveTo(dots[i].x, dots[i].y);
              bgCtx.lineTo(dots[j].x, dots[j].y);
              bgCtx.stroke();
            }
          }
        }
        // Draw dots
        dots.forEach(dot => {
          bgCtx.fillStyle = "#00aaff";
          bgCtx.beginPath();
          bgCtx.arc(dot.x, dot.y, dot.radius, 0, Math.PI * 2);
          bgCtx.fill();
        });
        requestAnimationFrame(animateBackground);
      }
      animateBackground();

      /* Update background canvas on window resize */
      window.addEventListener('resize', function() {
        bgWidth = window.innerWidth;
        bgHeight = window.innerHeight;
        bgCanvas.width = bgWidth;
        bgCanvas.height = bgHeight;
      });

      /* ===============================
         Main Control Area Logic
         =============================== */
      // Frequency mapping parameters
      const freqMin = 400;
      const freqMax = 480;
      const angleRange = 90; // degrees

      // Default frequencies and computed angles
      let leftFrequency = 440;
      let rightFrequency = 445;
      let leftAngle = 225 - ((leftFrequency - freqMin) / (freqMax - freqMin)) * angleRange;
      let rightAngle = -45 + ((rightFrequency - freqMin) / (freqMax - freqMin)) * angleRange;

      // Element references
      const circle = document.getElementById("circle");
      const leftHandle = document.getElementById("left-handle");
      const rightHandle = document.getElementById("right-handle");
      const leftFreqText = document.getElementById("left-freq");
      const rightFreqText = document.getElementById("right-freq");
      const beatFreqText = document.getElementById("beat-freq");
      const playPauseButton = document.getElementById("play-pause");
      const leftArcPath = document.getElementById("left-arc");
      const rightArcPath = document.getElementById("right-arc");
      const leftMovingDot = document.getElementById("left-moving-dot");
      const rightMovingDot = document.getElementById("right-moving-dot");

      // Circle fixed properties
      const circleSize = 400;
      const circleRadius = circleSize / 2; //200
      const circleCenter = { x: circleRadius, y: circleRadius };

      // Utility: Convert polar coordinates to Cartesian.
      function polarToCartesian(cx, cy, r, angleDeg) {
        const angleRad = angleDeg * Math.PI / 180;
        return {
          x: cx + r * Math.cos(angleRad),
          y: cy + r * Math.sin(angleRad)
        };
      }
      // Utility: Describe SVG arc path.
      function describeArc(cx, cy, r, startAngle, endAngle) {
        const start = polarToCartesian(cx, cy, r, startAngle);
        const end = polarToCartesian(cx, cy, r, endAngle);
        const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
        return [
          "M", start.x, start.y,
          "A", r, r, 0, largeArcFlag, 1, end.x, end.y
        ].join(" ");
      }
      // Update handle positions.
      function updateHandlePosition(handleElement, angleDeg) {
        const pos = polarToCartesian(circleCenter.x, circleCenter.y, circleRadius, angleDeg);
        handleElement.style.left = (pos.x - handleElement.offsetWidth / 2) + "px";
        handleElement.style.top = (pos.y - handleElement.offsetHeight / 2) + "px";
      }
      updateHandlePosition(leftHandle, leftAngle);
      updateHandlePosition(rightHandle, rightAngle);

      // Update control display (arcs, texts)
      function updateDisplay() {
        leftFreqText.textContent = leftFrequency.toFixed(0) + " Hz";
        rightFreqText.textContent = rightFrequency.toFixed(0) + " Hz";
        const beat = Math.abs(leftFrequency - rightFrequency).toFixed(0);
        beatFreqText.textContent = beat;

        // Left arc: from leftAngle to fixed 225
        leftArcPath.setAttribute("d", describeArc(circleCenter.x, circleCenter.y, circleRadius - 10, leftAngle, 225));
        // Right arc: from fixed -45 to rightAngle
        rightArcPath.setAttribute("d", describeArc(circleCenter.x, circleCenter.y, circleRadius - 10, -45, rightAngle));

        // Position frequency texts at arc midpoints
        let leftMidAngle = leftAngle + (225 - leftAngle) / 2;
        let leftPos = polarToCartesian(circleCenter.x, circleCenter.y, circleRadius + 20, leftMidAngle);
        leftFreqText.style.left = (leftPos.x - leftFreqText.offsetWidth / 2) + "px";
        leftFreqText.style.top = (leftPos.y - leftFreqText.offsetHeight / 2) + "px";

        let rightMidAngle = -45 + (rightAngle + 45) / 2;
        let rightPos = polarToCartesian(circleCenter.x, circleCenter.y, circleRadius + 20, rightMidAngle);
        rightFreqText.style.left = (rightPos.x - rightFreqText.offsetWidth / 2) + "px";
        rightFreqText.style.top = (rightPos.y - rightFreqText.offsetHeight / 2) + "px";
      }
      updateDisplay();

      // Audio context & setup.
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc1 = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      osc1.type = "sine";
      osc2.type = "sine";
      osc1.frequency.setValueAtTime(leftFrequency, audioCtx.currentTime);
      osc2.frequency.setValueAtTime(rightFrequency, audioCtx.currentTime);
      osc1.connect(audioCtx.destination);
      osc2.connect(audioCtx.destination);
      let audioStarted = false;
      let audioRunning = false;

      // Toggle play/pause with state-based icon.
      playPauseButton.addEventListener("click", () => {
        if (!audioStarted) {
          osc1.start();
          osc2.start();
          audioCtx.resume();
          audioStarted = true;
          audioRunning = true;
          setPauseIcon();
        } else {
          if (audioRunning) {
            audioCtx.suspend();
            audioRunning = false;
            setPlayIcon();
          } else {
            audioCtx.resume();
            audioRunning = true;
            setPauseIcon();
          }
        }
      });
      function setPlayIcon() {
        playPauseButton.innerHTML = `
          <svg id="play-icon" viewBox="0 0 64 64">
            <polygon points="16,12 16,52 48,32" />
          </svg>`;
      }
      function setPauseIcon() {
        playPauseButton.innerHTML = `
          <svg id="pause-icon" viewBox="0 0 64 64">
            <rect x="16" y="12" width="10" height="40"></rect>
            <rect x="38" y="12" width="10" height="40"></rect>
          </svg>`;
      }

      // Dragging logic
      let activeHandle = null;
      function handleMouseDown(e, type) {
        activeHandle = type;
        e.preventDefault();
      }
      leftHandle.addEventListener("mousedown", (e) => { handleMouseDown(e, "left"); });
      rightHandle.addEventListener("mousedown", (e) => { handleMouseDown(e, "right"); });
      document.addEventListener("mousemove", (e) => {
        if (!activeHandle) return;
        const rect = circle.getBoundingClientRect();
        const cx = rect.left + circleCenter.x;
        const cy = rect.top + circleCenter.y;
        const dx = e.clientX - cx;
        const dy = e.clientY - cy;
        let angle = Math.atan2(dy, dx) * 180 / Math.PI;
        if (activeHandle === "left") {
          if (angle < 135) angle = 135;
          if (angle > 225) angle = 225;
          leftAngle = angle;
          leftFrequency = freqMin + ((225 - leftAngle) / angleRange) * (freqMax - freqMin);
          updateHandlePosition(leftHandle, leftAngle);
        } else if (activeHandle === "right") {
          if (angle < -45) angle = -45;
          if (angle > 45) angle = 45;
          rightAngle = angle;
          rightFrequency = freqMin + ((rightAngle + 45) / angleRange) * (freqMax - freqMin);
          updateHandlePosition(rightHandle, rightAngle);
        }
        updateDisplay();
        if (audioStarted && audioRunning) {
          osc1.frequency.setValueAtTime(leftFrequency, audioCtx.currentTime);
          osc2.frequency.setValueAtTime(rightFrequency, audioCtx.currentTime);
        }
      });
      document.addEventListener("mouseup", () => {
        activeHandle = null;
      });

      // Animate moving dots along arcs.
      const period = 2000; // ms for one cycle
      function animateMovingDots(timestamp) {
        const t = (timestamp % period) / period;
        // Animate left moving dot along arc: from leftAngle to 225.
        const leftDotAngle = leftAngle + t * (225 - leftAngle);
        const leftDotPos = polarToCartesian(circleCenter.x, circleCenter.y, circleRadius - 10, leftDotAngle);
        leftMovingDot.style.left = (leftDotPos.x - leftMovingDot.offsetWidth / 2) + "px";
        leftMovingDot.style.top = (leftDotPos.y - leftMovingDot.offsetHeight / 2) + "px";

        // Animate right moving dot along arc: from -45 to rightAngle.
        const rightDotAngle = -45 + t * (rightAngle + 45);
        const rightDotPos = polarToCartesian(circleCenter.x, circleCenter.y, circleRadius - 10, rightDotAngle);
        rightMovingDot.style.left = (rightDotPos.x - rightMovingDot.offsetWidth / 2) + "px";
        rightMovingDot.style.top = (rightDotPos.y - rightMovingDot.offsetHeight / 2) + "px";
        requestAnimationFrame(animateMovingDots);
      }
      requestAnimationFrame(animateMovingDots);
    </script>
  </body>
</html>
